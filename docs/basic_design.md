# 音楽アプリケーション 基本設計書

**バージョン:** 1.0  
**作成日:** 2025年3月2日  

## 1. アーキテクチャ設計

### 1.1 全体アーキテクチャ

システムアーキテクチャ図は「system-architecture」アーティファクトを参照してください。

### 1.2 コンポーネント構造

アプリケーションは次の主要コンポーネントで構成されます：

1. **フロントエンドアプリケーション**
   - Webアプリケーション（React/Vue.js）
   - モバイルアプリケーション（PWA対応）
   - デスクトップアプリケーション（Electron）

2. **バックエンドサービス**
   - 音楽管理サービス：楽曲メタデータ、ストリーミング管理
   - ユーザーサービス：認証、プロフィール管理
   - 支払サービス：課金、決済、収益分配
   - 分析サービス：再生統計、売上分析
   - コミュニティサービス：ファンクラブ、コメント管理

3. **データストア**
   - PostgreSQL：リレーショナルデータ
   - Redis：キャッシュ、セッション管理
   - AWS S3：音楽ファイル保存

4. **インフラストラクチャ**
   - Kubernetes：コンテナオーケストレーション
   - AWS CloudFront：コンテンツ配信
   - ElasticSearch：検索機能
   - AWS ELB：負荷分散

## 2. データベース設計

### 2.1 ER図

データベースER図は「database-schema」アーティファクトを参照してください。

### 2.2 主要テーブル定義

#### 2.2.1 USERSテーブル
- ユーザーID（PK）
- メールアドレス（一意）
- パスワードハッシュ
- 表示名
- プロフィール情報
- プロフィール画像URL
- 作成日時
- 更新日時
- ロール（アーティスト/リスナー/管理者）
- 認証済みフラグ

#### 2.2.2 MUSICテーブル
- 楽曲ID（PK）
- アーティストID（FK）
- タイトル
- 説明
- ジャンル
- カバーアート URL
- オーディオファイル URL
- 再生時間（秒）
- 価格
- リリース日
- 作成日時
- 更新日時
- 公開フラグ
- 再生回数

#### 2.2.3 TRANSACTIONSテーブル
- 取引ID（PK）
- ユーザーID（FK）
- 楽曲ID（FK）
- 金額
- 取引タイプ（購入/寄付/サブスクリプション）
- ステータス（完了/保留/失敗）
- 作成日時
- 支払い方法
- 取引参照番号

## 3. API設計

### 3.1 RESTful API エンドポイント

#### ユーザー関連
```
GET    /api/v1/users                 # ユーザー一覧取得（管理者用）
GET    /api/v1/users/{id}            # ユーザー詳細取得
POST   /api/v1/users                 # ユーザー登録
PUT    /api/v1/users/{id}            # ユーザー情報更新
DELETE /api/v1/users/{id}            # ユーザー削除
POST   /api/v1/auth/login            # ログイン
POST   /api/v1/auth/logout           # ログアウト
POST   /api/v1/auth/refresh          # トークンリフレッシュ
```

#### 楽曲関連
```
GET    /api/v1/music                    # 楽曲一覧取得
GET    /api/v1/music/{id}               # 楽曲詳細取得
POST   /api/v1/music                    # 楽曲登録
PUT    /api/v1/music/{id}               # 楽曲情報更新
DELETE /api/v1/music/{id}               # 楽曲削除
GET    /api/v1/artists/{id}/music       # アーティスト楽曲取得
POST   /api/v1/music/{id}/stream        # ストリーミングリクエスト
GET    /api/v1/music/{id}/stats         # 楽曲統計取得
```

#### 取引関連
```
GET    /api/v1/transactions               # 取引一覧取得
GET    /api/v1/transactions/{id}          # 取引詳細取得
POST   /api/v1/transactions               # 新規取引作成
GET    /api/v1/users/{id}/transactions    # ユーザー取引履歴取得
POST   /api/v1/checkout                   # 決済処理
GET    /api/v1/artists/{id}/revenue       # アーティスト収益取得
```

#### プレイリスト関連
```
GET    /api/v1/playlists                 # プレイリスト一覧取得
GET    /api/v1/playlists/{id}            # プレイリスト詳細取得
POST   /api/v1/playlists                 # プレイリスト作成
PUT    /api/v1/playlists/{id}            # プレイリスト更新
DELETE /api/v1/playlists/{id}            # プレイリスト削除
POST   /api/v1/playlists/{id}/items      # プレイリストに楽曲追加
DELETE /api/v1/playlists/{id}/items/{id} # プレイリストから楽曲削除
```

### 3.2 WebSocketイベント

```
user.notification     # ユーザー通知イベント
revenue.update        # 収益更新イベント
play.start            # 楽曲再生開始イベント
play.complete         # 楽曲再生完了イベント
comment.new           # 新規コメントイベント
```

## 4. UI設計

### 4.1 画面レイアウト概要

UIモックアップは「ui-mockup」アーティファクトを参照してください。

### 4.2 主要画面一覧

1. **ホーム画面**
   - おすすめ楽曲
   - 最近再生した曲
   - 新着リリース
   - おすすめアーティスト

2. **検索画面**
   - 検索バー
   - フィルター（ジャンル、リリース日等）
   - 検索結果表示

3. **アーティストプロフィール**
   - プロフィール情報
   - 楽曲リスト
   - ファンクラブ情報
   - 統計情報

4. **楽曲詳細画面**
   - 楽曲情報
   - 再生コントロール
   - 購入/寄付オプション
   - コメント/レビュー

5. **アーティストダッシュボード**
   - 収益サマリー
   - 再生統計
   - ファン地域分布
   - リスナー行動分析

6. **リスナーライブラリ**
   - 購入した楽曲
   - 作成したプレイリスト
   - お気に入りアーティスト
   - 再生履歴

7. **設定画面**
   - アカウント設定
   - プロフィール編集
   - 支払い方法管理
   - 通知設定

### 4.3 操作フロー

ユーザー操作フローは「user-flow」アーティファクトを参照してください。

## 5. セキュリティ設計

### 5.1 認証・認可

1. **認証方式**
   - OAuth 2.0ベースの認証フロー
   - JWT（JSON Web Token）を使用したステートレス認証
   - リフレッシュトークンによるセッション管理

2. **認可制御**
   - ロールベースアクセス制御（RBAC）
   - リソースごとの権限設定
   - アクセスレベルの階層化（公開/限定公開/非公開）

3. **トークン管理**
   - アクセストークン有効期限：1時間
   - リフレッシュトークン有効期限：2週間
   - 不審なアクセスパターン検出時の強制ログアウト

### 5.2 データ保護

1. **保存データ暗号化**
   - ユーザーパスワード：bcrypt（コスト係数12）
   - 支払い情報：AES-256
   - 個人識別情報：暗号化ストレージ

2. **通信暗号化**
   - HTTPS（TLS 1.3）によるエンドツーエンド暗号化
   - API呼び出しにおける追加の署名検証

3. **データバックアップ**
   - 日次増分バックアップ
   - 週次フルバックアップ
   - 地理的に分散した暗号化ストレージ

## 6. パフォーマンス設計

### 6.1 スケーリング戦略

1. **水平スケーリング**
   - マイクロサービス単位のスケールアウト
   - Kubernetes上のPod自動スケーリング
   - リージョン別デプロイメント

2. **キャッシュ戦略**
   - 多層キャッシュアーキテクチャ
   - Redis：ホットデータ、セッション情報
   - CDN：静的アセット、高頻度アクセス楽曲

3. **データベースパフォーマンス**
   - 読み取り/書き込み分離
   - パーティショニング（アーティストID、リリース日基準）
   - インデックス最適化

### 6.2 ストリーミング最適化

1. **アダプティブビットレート**
   - 視聴者のネットワーク状態に応じて品質自動調整
   - 複数品質のトランスコード（128kbps〜320kbps）

2. **プログレッシブダウンロード**
   - バッファ管理の最適化
   - 先読みアルゴリズムによるシームレス再生

3. **エッジキャッシング**
   - CloudFrontを活用したグローバルエッジキャッシング
   - 地域特化コンテンツの局所的キャッシュ優先

## 7. 実装計画（個人開発向け）

### 7.1 開発フェーズ

個人開発者がフルタイムの本業を持ちながら取り組むことを前提に、より小さなステップに分割しました。週末や平日夜の限られた時間で進行できるよう、各フェーズは2〜3ヶ月の期間を想定しています。

| フェーズ | 期間 | 主要タスク | 目標 |
|---------|------|-----------|------|
| **フェーズ0: 基盤構築** | 3ヶ月 | ・最小限のインフラ設定（AWS Free Tier活用）<br>・基本的なユーザー認証<br>・シンプルなWeb UIフレームワーク | 開発環境とベース機能の確立 |
| **フェーズ1A: 最小機能版** | 3ヶ月 | ・単純な楽曲アップロード機能<br>・基本的な音楽再生機能<br>・アーティストプロフィール基本機能 | 10人のテストアーティストが利用可能な状態 |
| **フェーズ1B: 基本マネタイズ** | 3ヶ月 | ・シンプルな直接販売機能（PayPal連携）<br>・基本的な収益表示<br>・楽曲のダウンロード機能 | 実際の取引が可能な状態 |
| **フェーズ1C: コミュニティ基盤** | 3ヶ月 | ・コメント機能<br>・SNSシェア連携<br>・フォロー機能 | 50人のアーティスト、300人のリスナー |
| **フェーズ2A: プラットフォーム拡張** | 3ヶ月 | ・モバイル対応強化<br>・検索機能拡充<br>・プレイリスト管理 | MAU 1,000人達成 |
| **フェーズ2B: 収益モデル強化** | 3ヶ月 | ・複数決済オプション<br>・サブスクリプション導入<br>・簡易ダッシュボード | 月間売上100万円達成 |

### 7.2 開発アプローチとリソース節約

限られたリソースで効率的に開発を進めるためのアプローチです：

1. **既存サービス活用**
   - 認証：Firebase Authentication または Auth0 を利用
   - ストレージ：AWS S3（Free Tier）を活用
   - データベース：初期は Firebase Realtime Database または MongoDB Atlas（無料枠）から始める
   - 決済：Stripe または PayPal の API を利用

2. **アーキテクチャ簡素化**
   - 初期はマイクロサービスではなくモノリシックアーキテクチャで構築
   - サーバーレスアーキテクチャ（AWS Lambda など）を部分的に活用
   - 複雑な機能は後回しにし、コア機能を優先

3. **開発手法**
   - 手動テスト中心の開発で、自動テストは重要なコンポーネントのみに限定
   - クローズドアルファ→クローズドベータ→オープンベータの段階的リリース
   - 初期ユーザーからのフィードバックを直接収集し、頻繁に反映

4. **コミュニティ活用**
   - オープンソースライブラリの積極活用
   - 初期はオープンソースとして開発し、コミュニティの貢献を募る選択肢も検討
   - 初期アーティストと協力し、実際のニーズに基づいた機能開発を優先

### 7.3 テスト計画（個人開発向け）

1. **基本テスト**
   - 主要機能の手動テスト
   - 重要な API エンドポイントのみ単体テスト自動化

2. **友人・知人によるテスト**
   - 小規模なアルファテスター集団（5〜10人）でフィードバック収集
   - 毎月1回のペースでテストセッション実施

3. **段階的ユーザーテスト**
   - フェーズ1A完了時に協力アーティスト（5〜10名）に限定公開
   - フェーズ1C完了時に招待制でベータ版リリース（〜100名）
   - フェーズ2A完了時にオープンベータとして一般公開

## 8. 運用・監視設計

### 8.1 監視計画

1. **システム監視**
   - インフラストラクチャメトリクス（CPU、メモリ、ディスク使用率）
   - アプリケーションメトリクス（レスポンス時間、エラー率）
   - ビジネスメトリクス（ユーザー登録数、楽曲アップロード数、収益）

2. **アラート設定**
   - クリティカルイベントの即時通知
   - 運用チームへのエスカレーションフロー
   - 自動復旧プロセスの組み込み

### 8.2 バックアップと復旧計画

1. **定期バックアップ**
   - データベース：日次フルバックアップ、時間単位WALバックアップ
   - ユーザーコンテンツ：差分バックアップ

2. **災害復旧**
   - RTO（目標復旧時間）：4時間以内
   - RPO（目標復旧時点）：15分以内
   - マルチリージョンフェイルオーバー構成

## 9. 収益化モデル詳細設計

### 9.1 アーティスト収益化オプション

1. **直接販売**
   - 単曲販売：アーティストが価格設定可能（最低価格100円〜）
   - アルバム販売：割引バンドル設定可能
   - プラットフォーム手数料：売上の15%

2. **ストリーミング収益**
   - 再生回数ベースの収益分配
   - 1再生あたり0.3〜0.5円の分配（最低30秒の再生で計上）
   - リスナーのサブスクリプション料金の70%をアーティストプールへ

3. **ファンクラブ**
   - 月額サブスクリプション（アーティストが価格設定）
   - 特典コンテンツ、先行リリースアクセス
   - プラットフォーム手数料：月額料金の10%

4. **投げ銭/チップ**
   - ワンクリック少額決済システム
   - カスタム金額設定
   - プラットフォーム手数料：5%

### 9.2 収益分析ダッシュボード

収益分析ダッシュボードの実装例は「revenue-dashboard」アーティファクトを参照してください。

## 10. 個人開発向け現実的ビジネス戦略

### 10.1 現実的な成長指標

個人開発プロジェクトとして達成可能な現実的な指標を設定します：

1. **ユーザー獲得・定着（初年度）**
   - 月間アクティブユーザー（MAU）：1,000人達成
   - アーティスト数：100名
   - コアユーザー（週1回以上利用）：200人

2. **エンゲージメント（初年度）**
   - 月間総再生数：10,000回
   - 月間アップロード曲数：50曲
   - SNSシェア数：500回/月

3. **マネタイズ（初年度）**
   - 月間取引総額（GMV）：100万円
   - 有料楽曲購入率：MAUの5%
   - 最低運営コスト（サーバー等）を賄えるレベルの収益

### 10.2 段階的成長計画

1. **立ち上げ期（リリース後6ヶ月）**
   - 協力アーティスト10〜20名を中心にクローズドベータ運用
   - 友人・知人中心のリスナー100〜200人規模
   - 月間取引総額10万円程度
   - フィードバックを集中的に収集し、製品改善に注力

2. **初期成長期（リリース後1年）**
   - アーティスト100名、MAU 1,000人の達成
   - 月間取引総額100万円の実現
   - 最低限のランニングコストを収益でカバー
   - 特定ジャンル・コミュニティでの認知獲得

3. **安定期（リリース後2年）**
   - アーティスト500名、MAU 5,000人の達成
   - 月間取引総額500万円の実現
   - 個人の副業として一定の収入源に成長
   - 特定の強みを持つニッチプラットフォームとしての地位確立

4. **次のステップ（2年以降）**
   - この時点での成果に基づき、以下の選択肢を検討：
     a) 引き続き個人プロジェクトとして維持・成長
     b) 小規模な創業チームを結成し、本格的な事業化
     c) 既存の音楽関連サービスへの売却
     d) 隣接サービスとの提携・統合

### 10.3 リスク低減戦略

1. **最小コストでの運用**
   - サーバーコスト：月5,000円以内を目標
   - クラウドサービスの無料枠を最大限活用
   - オートスケーリングでピーク時のみリソース拡張

2. **段階的な投資**
   - 各フェーズの目標達成を確認後、次のフェーズへ投資
   - 収益の一部を再投資することで自己資金内で成長

3. **副業としての持続可能性**
   - 週10〜15時間の作業で運用可能な仕組み作り
   - 自動化できる部分は積極的に自動化
   - コミュニティ・モデレーターの育成

## 11. 個人開発者向けまとめと提言

本基本設計書では、要件定義書とシステム仕様書に基づき、インディーズミュージシャンの収益化とファン獲得を支援するプラットフォームの設計を行いました。特に、フルタイムの本業を持つ個人開発者が資金調達なしで実現可能なアプローチを重視しています：

1. **個人開発で実現可能な機能セット**
   - 最小限の機能からスタートし、段階的に拡張
   - 既存サービス・ツールを積極活用して開発工数を削減
   - シンプルなUIと高い使用性を両立

2. **持続可能な開発・運営体制**
   - 副業として継続可能な週10〜15時間の作業量に収める
   - ランニングコストを最小限に抑える設計
   - 自動化とコミュニティ活用による運用効率化

3. **現実的な差別化ポイント**
   - 特定ジャンル・コミュニティに特化したニッチ戦略
   - 大手にはない「作り手と聴き手の距離の近さ」を重視
   - 個人開発だからこそ実現できる柔軟性と独自性

### 個人開発者向け提言

1. **極小MVPから始める**
   - 最初は複数機能の「浅い」実装より、1機能の「深い」実装を優先
   - リリース第一版は再生とアップロードの基本機能に絞り込む
   - 3ヶ月以内に何らかの形で第一版をリリースする

2. **仲間づくりを意識する**
   - 開発初期からアーティストの協力者を5名程度確保
   - 開発過程を積極的にSNSで発信し、賛同者を募る
   - 技術的協力者も探し、部分的な開発協力を得る

3. **継続可能な体制作り**
   - 毎週決まった時間を確保して着実に進める
   - 集中開発期間と休息期間を明確に分ける
   - 達成感を得られる小さなマイルストーンを設定

4. **無理のない範囲で挑戦**
   - 最初から完璧を目指さず、徐々に改善していくマインド
   - 本業とのバランスを常に意識し、燃え尽き症候群を防ぐ
   - 小さな成功体験を積み重ねて長期的モチベーションを維持

個人開発プロジェクトとして現実的な範囲での設計に修正することで、持続可能な開発と段階的な成長が可能になります。要件を絞り込み、最小限の労力・コストで価値を提供することを最優先に、インディーズミュージシャンとファンを繋ぐプラットフォームの第一歩を踏み出しましょう。
